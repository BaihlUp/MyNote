---
title: 02 - 论层次式架构
date: 2024-05-21
categories: 
tags: 
published: false
---

大纲：（尽量多写，考试中可以进行变化，引用）
1. 摘要部分：使用通用模版进行介绍，然后根据论文题目进行概述
2. 正文
	1. 项目背景：使用模版，进行背景介绍，引出项目，介绍项目的功能

# 摘要 （290~320）两段 每段150
>（时间 + 项目 + 项目简介 + 投入 + 历时 + 成功交付客户好评 + 结合具体题目说明本文结构  ）

我所在的公司是一家领先的云计算服务提供商。2021年5月，我负责主持了公司的Web应用安全网关系统的研发，并担任系统架构设计师，全面负责系统的整体架构设计和技术选型工作。该系统旨在为云上租户的网站提供全面的安全防护能力，主要包括 控制和管理平台、报表生成、日志分析、网络接入和Web安全防护等功能模块。我在设计过程中，充分利用了云计算基础设施的优势，确保系统具备高可用、易部署和易维护的特点。整体架构设计，采用了层次式设计方法，将各功能模块进行解耦，大大降低了系统的复杂性和部署难度。本文结合笔者的实际项目经验，详细阐述了Web应用安全网关系统的开发过程，包括需求分析、架构设计、技术选型、开发实施及测试部署等方面的内容。同时，总结了项目中的经验教训，分享了在云计算环境下构建高效、安全、可靠的Web应用安全网关系统的最佳实践。项目历时近一年，于2022年4月正式发布上线，目前已在多个云中心成功交付，得到了用户的一致好评。


> 不同的论点，修改下描述、此项目 适用于  云原生、微服务、层次架构、SOA架构
# 项目背景（400~500）
>（为什么要做这个项目 + 项目功能和技术介绍 + 回应子题目并过度到主体）

我司作为一家领先的云计算服务提供商，在全国拥有100多个数据中心，托管着大量客户的不同网站业务。为了保护这些客户网站的安全运行，避免遭受日益复杂的网络安全攻击，我们在云上部署了大量第三方安全厂商的Web安全网关系统。然而，这些第三方产品往往通过定制化网络部署和适配的方式接入我们的云中心机房，技术和部署形态各异，无法支持不同租户共同使用。这种方式导致每个租户必须独享一套系统，造成成本高昂且资源浪费，同时增加了运维的复杂性和难度。
因此，公司决定开发一套专为云上租户使用的Web应用安全网关系统，旨在最大限度利用云计算的优势，提供高可用性、高性能、易部署、易维护的解决方案。该项目自2021年5月开始，历时近一年，于2022年4月正式发布上线，项目投入约756万元人民币。在本项目中，我作为架构师，主要负责了系统的整体架构设计和技术选型工作。为了达到系统易部署、易扩展、易维护的特点，我采用了层次式架构设计，这种设计方法实现了模块化开发，降低了各模块之间的耦合度。每个层次负责特定的功能模块，不同层次之间通过服务调用方式进行交互，只与相邻层进行通信。系统主要分为三层，分别为 表示层、业务逻辑层和流量处理层。表示层提供了查看和配置功能，用户可以进行添加防护站点、配置防护策略、查看安全防护报表、查看网站流量趋势、检索网站日志等。业务逻辑层主要处理表示层的请求，接收到查看和检索类的请求，则查询数据库、ElasticSearch等，或者需要的数据，并通过处理后返回给表示层，接收到配置下发类请求，则进行解析和处理，下发给数据处理层，以控制数据处理和检测的逻辑。数据处理层主要实现接收防护站点的流量并且检测和分析，输出检测结果并记录日志。
在项目开发的前期，由于整个产品的功能和需求比较明确，我们采用了瀑布模型进行开发，完成了Web应用防火墙的基础功能，实现了与市场上同类产品的功能对齐。在项目的后期，我们收集并分析了云上租户的需求，采用敏捷迭代的开发方式，按版本定期上线，不断优化和完善产品。该系统于2022年4月正式发布后，已在多个云中心成功上线并稳定运行至今，得到了用户的一致好评。

本文将以Web应用安全网关系统为例，详细论述层次式架构在实际项目中的具体应用和实现，分享项目开发过程的经验和心得，希望为同行提供有价值的参考。

# 回应子题目2（300字）

层次式架构是一种常见且高效的系统架构风格，通过将系统分为若干层次，每层负责特定功能和职责，并通过定义明确的接口进行通信。层次式架构具有模块化设计、独立性和可替换性，其主要优势在于易维护和扩展，各层次职责明确，修改和扩展某功能只需关注相关层次，降低了维护难度和风险。开发团队可以并行工作，缩短开发周期，同时增强系统灵活性，使其能够快速应对需求变化。模块化设计还提高了代码复用率，减少了重复劳动，并便于单独进行单元测试，确保每层次功能正确，提高整体系统质量。在Web应用安全网关系统的设计中，采用层次架构能够实现高可用性、易部署和易维护等目标，充分发挥云计算的优势，为系统的长期维护和演进提供坚实基础。下边详细介绍项目中对层次式架构的应用。

# 正文（3段，每段300字）

Web应用安全网关的表示层注重用户体验和灵活性，通过浏览器和SDK客户端两种方式实现主要功能，包括 添加防护站点、配置安全规则、查看和检索日志、查看安全报表等。用户通过浏览器访问表示层页面，可输入防护站点信息、选择和配置安全规则，这些操作通过API接口传递给业务逻辑层处理和存储。日志检索功能允许用户根据条件检索日志，检索请求通过API接口发送到业务逻辑层获取数据并返回显示。安全报表展示系统生成的流量分析和攻击统计等数据，报表数据有业务逻辑层处理后通过API接口返回表示层。前端采用React或Vue.js等现代框架构建页面，提供动态和响应式用户界面，提升用户体验。后端使用Node.js或Java技术构建API接口，前后端通信采用RESTful API，确保数据传输高效可靠，并使用JSON格式进行数据交换。HTTPS协议用于表示层和业务逻辑层之间的通信，确保数据传输安全，用户认证和授权通过OAuth2.0或JWT实现。SDK封装了API接口调用细节，简化客户端开发的复杂性。通过这些功能和技术选择，表示层实现了丰富功能并确保系统高安全，为用户提供了良好体验。

Web应用安全网关的业务逻辑层承担着核心处理功能，负责处理表示层的请求，主要分为查看和检索类请求和配置下发类请求。当接收到查看和检索类请求时，业务逻辑层会查询数据库和ElasticSearch等数据存储系统，获取所需数据并进行处理后返回给表示层。对于配置下发类请求，如防护站点添加和安全规则配置，业务逻辑层会对配置进行解析和处理，然后通过消息队列或HTTP API下发给数据处理层，以控制具体的数据处理和检测逻辑。业务逻辑层使用Spring Boot等后端框架，采用MVC设计模式分离数据处理、业务逻辑和用户界面，提高系统可维护性。数据查询集成了PostgreSQL和ElasticSearch，使用JPA或Hibernate进行数据库访问，确保高效性和安全性。配置下发采用Redis发布订阅机制与数据处理层通信，当配置添加和修改后，实时通知给数据处理层的多个实例，实现高效低延迟的数据传输。

Web安全网关的数据处理层是系统的核心，负责接收用户网站请求，并以反向代理方式转发到用户源站。在转发过程中，经历安全检测、行为和统计分析等步骤。首先，根据站点信息配置反向代理服务器确保请求正确转发。然后，根据预设的安全规则进行Web安全检测，深度分析请求参数、头部信息等，识别潜在的恶意攻击。同时，进行行为和统计分析，识别异常行为。针对恶意请求，卡采取多种处理方式，如拦截、人机验证和告警。技术上采用反向代理（如 Nginx）、大数据技术（如 Flink）进行数据分析、基于C语言自研规则引擎进行安全规则匹配。与其他组件的高效通信采用RESTful API或者消息队列。如对请求日志的采集，通过把日志发送到KafKa，然后由日志分析和存储组件进行读取。

以上介绍了每层的功能和技术选型，其中每一层都有多个提供不同类型服务的功能模块，为了实现独立部署、升级和维护，采用了微服务架构，将系统划分为 管理和控制平台、网络接入、规则引擎、人机验证、日志采集、报表生成等，每个模块作为独立的微服务运行着，具备高度的独立性和灵活性。为了满足系统高性能的和高可用性的要求，我们在部分核心模块上采用了多副本部署的策略。这意味着同一个服务模块会运行多个实例，通过负载均衡来分发请求，确保在高并发场景下也能稳定运行。此外，这种方式还能提供故障隔离，当某个实例出现问题时，其他实例可以继续提供服务，增强了系统的容错能力。
整个系统基于Docker和Kubernetes进行容器化管理。Docker提供了轻量级的容器环境，使得每个微服务可以在隔离的环境中运行，避免环境依赖问题。Kubernetes则负责容器集群的编排和管理，实现了自动化部署、资源扩缩容、资源配额限制和服务可用性监控等功能。通过Kubernetes，我们能够动态调整资源分配，确保系统在不同负载情况下都能高效运行。
微服务架构的最大优势在于服务之间的解耦，各个服务模块通过定义好的通信协议（如 RESTful API 或 gRPC）进行互相调用，不需要了解对方的内部实现细节。这种解耦使得每个服务模块可以独立开发和维护，开发团队可以根据需求快速迭代和发布新版本，不会影响其他模块的正常运行。

# 结尾（300~400）
（强调项目顺利交付运行反馈好 + 自己的收获或者不足之处）
1. 项目效果：呼应论点、上线、稳定运行、获得好评、下一步计划
2. 存在的问题：阐述一个小问题，并且已经解决
3. 收获、反思、复盘

经过近一年的项目开发，Web应用安全网关系统顺利在各大云中心进行交付。由于采用了层次式架构设计，各模块之间实现了解耦，大大降低了部署的难度。模块化设计不仅提高了系统的可扩展性，还使得在大型云中心通过增加节点数量来扩展系统的业务承载能力成为可能。在实际运行近两年的时间里，系统表现稳定，客户反馈良好。这得益于我们的架构设计，确保了各功能模块的独立性和高效协作，使得系统在处理不同业务需求时表现出色。同时，通过不断的优化和改进，系统的性能和可靠性得到了进一步提升。
然而，在项目过程中也暴露了一些不足之处。例如，由于云上的租户网站业务种类繁多，系统在初期未能全面覆盖所有业务需求。尽管如此，通过后续的迭代和优化调整，我们成功克服了这些挑战，确保系统的整体稳定性和功能完善性。
展望未来，为了应对不断变化的技术需求和业务挑战，我将继续提升自己的专业水平。在后续的学习和工作中，我会不断充电，深入学习最新的技术和方法，进一步完善系统架构设计。通过持续的知识积累和实践，我希望能够在未来的项目中实现更加出色的设计和开发工作。总的来说，这个项目的成功不仅体现了团队的合作精神和技术实力，也为我们积累了宝贵的经验。我们将在此基础上不断改进，争取在未来的项目中取得更大的突破和成就。



